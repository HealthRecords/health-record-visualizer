{% extends "base.html" %}
{% from "macros.html" import cda_data_card %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-2">
                    <i class="bi bi-file-earmark-medical text-primary me-2"></i>
                    CDA Health Data
                </h1>
                <p class="text-muted mb-0">
                    Clinical Document Architecture data from Apple Health export
                    {% if categories %}({{ categories|length }} categories){% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

{% if categories %}
<div class="row g-4">
    {% for category in categories %}
        {% set description = "Heart rate, oxygen saturation, respiratory rate, and other vital signs" if "vital" in category.name.lower() else "Laboratory test results including glucose measurements" if "lab" in category.name.lower() else "Height, weight, and body measurements" if "biometric" in category.name.lower() else "Health observations and measurements" %}
        {% set icon_class = "bi-heart-pulse" if "vital" in category.name.lower() else "bi-flask" if "lab" in category.name.lower() else "bi-person-badge" if "biometric" in category.name.lower() else "bi-graph-up" %}
        {% set icon_color = "text-danger" if "vital" in category.name.lower() else "text-primary" if "lab" in category.name.lower() else "text-success" if "biometric" in category.name.lower() else "text-info" %}
        
        {{ cda_data_card(category.name, description, category.count, "observations", category.url, icon_class, icon_color) }}
    {% endfor %}
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            <i class="bi bi-info-circle me-2"></i>
            <strong>No CDA data found.</strong>
            <p class="mb-0 mt-2">
                The CDA database has not been created yet. To process your CDA data, run:
                <br>
                <code class="ms-2">python preprocess_cda.py /path/to/export_cda.xml</code>
            </p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

