{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="jumbotron bg-primary text-white rounded p-5 mb-4">
            <h1 class="display-4">
                <i class="bi bi-heart-pulse me-3"></i>
                Health Data Explorer
            </h1>
            <p class="lead">
                Explore your Apple Health data exports with an interactive web interface.
                Navigate through observations, conditions, medications, and procedures.
            </p>
            {% if total_files or has_cda %}
            <hr class="my-4">
            <div class="row">
                {% if total_files %}
                <div class="col-md-6">
                    <p class="mb-0">
                        <i class="bi bi-files me-2"></i>
                        <strong>{{ total_files }}</strong> FHIR data files found
                    </p>
                </div>
                {% endif %}
                {% if has_cda %}
                <div class="col-md-6">
                    <p class="mb-0">
                        <i class="bi bi-database me-2"></i>
                        <strong>CDA database</strong> available
                    </p>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% if menu_items %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="bi bi-list-ul me-2"></i>
            Available Data Types
        </h2>
    </div>
</div>

<div class="row g-4">
    {% for item in menu_items %}
    <div class="col-lg-4 col-md-6">
        <div class="card h-100 shadow-sm hover-shadow">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">
                    {% if item.name == "Observation" %}
                        <i class="bi bi-activity text-success me-2"></i>
                    {% elif item.name == "Condition" %}
                        <i class="bi bi-clipboard2-pulse text-warning me-2"></i>
                    {% elif item.name == "MedicationRequest" %}
                        <i class="bi bi-capsule text-primary me-2"></i>
                    {% elif item.name == "Procedure" %}
                        <i class="bi bi-bandaid text-info me-2"></i>
                    {% elif item.name == "AllergyIntolerance" %}
                        <i class="bi bi-exclamation-triangle text-danger me-2"></i>
                    {% else %}
                        <i class="bi bi-file-earmark-medical text-secondary me-2"></i>
                    {% endif %}
                    
                    {% if item.name == "MedicationRequest" %}
                        Medications
                    {% elif item.name == "AllergyIntolerance" %}
                        Allergies
                    {% elif item.name == "DocumentReference" %}
                        Documents
                    {% else %}
                        {{ item.name }}s
                    {% endif %}
                </h5>
                
                <p class="card-text text-muted mb-3">
                    {% if item.name == "Observation" %}
                        Vital signs, measurements, and laboratory results
                    {% elif item.name == "Condition" %}
                        Medical conditions and diagnoses
                    {% elif item.name == "MedicationRequest" %}
                        Prescribed medications and treatments
                    {% elif item.name == "Procedure" %}
                        Medical procedures and interventions
                    {% elif item.name == "AllergyIntolerance" %}
                        Allergies and intolerances
                    {% elif item.name == "DocumentReference" %}
                        Clinical documents and reports
                    {% else %}
                        {{ item.name }} records
                    {% endif %}
                </p>
                
                <div class="mt-auto">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-secondary fs-6">
                            {{ item.count }} files
                        </span>
                        <a href="{{ item.url }}" class="btn btn-outline-primary">
                            Explore
                            <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if cda_items %}
<div class="row mt-5">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="bi bi-file-earmark-medical text-primary me-2"></i>
            CDA Health Data
            <small class="text-muted ms-2">(Clinical Document Architecture)</small>
        </h2>
    </div>
</div>

<div class="row g-4">
    {% for item in cda_items %}
    <div class="col-lg-4 col-md-6">
        <div class="card h-100 shadow-sm hover-shadow border-primary">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">
                    {% if "vital signs" in item.name.lower() %}
                        <i class="bi bi-heart-pulse text-danger me-2"></i>
                    {% elif "laboratory" in item.name.lower() %}
                        <i class="bi bi-flask text-primary me-2"></i>
                    {% elif "biometric" in item.name.lower() %}
                        <i class="bi bi-person-badge text-success me-2"></i>
                    {% else %}
                        <i class="bi bi-graph-up text-info me-2"></i>
                    {% endif %}
                    {{ item.name }}
                </h5>
                
                <p class="card-text text-muted mb-3">
                    {% if "vital signs" in item.name.lower() %}
                        Heart rate, oxygen saturation, respiratory rate from Apple Watch and other devices
                    {% elif "laboratory" in item.name.lower() %}
                        Laboratory test results including glucose measurements from Dexcom G7
                    {% elif "biometric" in item.name.lower() %}
                        Height, weight, and body measurements
                    {% else %}
                        Health observations and measurements
                    {% endif %}
                </p>
                
                <div class="mt-auto">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-primary fs-6">
                            {{ "{:,}".format(item.count) }} observations
                        </span>
                        <a href="{{ item.url }}" class="btn btn-outline-primary">
                            Explore
                            <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if not menu_items and not cda_items %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>No health data found!</strong>
            <p class="mb-0 mt-2">
                Please ensure your Apple Health export data is available in the configured directory.
                Check the <code>config.py</code> file to verify the data path.
            </p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.hover-shadow');
    
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });
});
</script>
{% endblock %}