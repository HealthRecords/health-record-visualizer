{% extends "base.html" %}
{% from "macros.html" import data_card, cda_data_card %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="jumbotron bg-primary text-white rounded p-5 mb-4">
            <h1 class="display-4">
                <i class="bi bi-heart-pulse me-3"></i>
                Health Data Explorer
            </h1>
            <p class="lead">
                Explore your Apple Health data exports with an interactive web interface.
                Navigate through observations, conditions, medications, and procedures.
            </p>
            {% if total_files or has_cda %}
            <hr class="my-4">
            <div class="row">
                {% if total_files %}
                <div class="col-md-6">
                    <p class="mb-0">
                        <i class="bi bi-files me-2"></i>
                        <strong>{{ total_files }}</strong> FHIR data files found
                    </p>
                </div>
                {% endif %}
                {% if has_cda %}
                <div class="col-md-6">
                    <p class="mb-0">
                        <i class="bi bi-database me-2"></i>
                        <strong>CDA database</strong> available
                    </p>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% if menu_items %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="bi bi-list-ul me-2"></i>
            Available Data Types
        </h2>
    </div>
</div>

<div class="row g-4">
    {% for item in menu_items %}
        {% set title = "Medications" if item.name == "MedicationRequest" else "Allergies" if item.name == "AllergyIntolerance" else "Documents" if item.name == "DocumentReference" else item.name + "s" %}
        {% set description = "Vital signs, measurements, and laboratory results" if item.name == "Observation" else "Medical conditions and diagnoses" if item.name == "Condition" else "Prescribed medications and treatments" if item.name == "MedicationRequest" else "Medical procedures and interventions" if item.name == "Procedure" else "Allergies and intolerances" if item.name == "AllergyIntolerance" else "Clinical documents and reports" if item.name == "DocumentReference" else item.name + " records" %}
        {% set icon_class = "bi-activity" if item.name == "Observation" else "bi-clipboard2-pulse" if item.name == "Condition" else "bi-capsule" if item.name == "MedicationRequest" else "bi-bandaid" if item.name == "Procedure" else "bi-exclamation-triangle" if item.name == "AllergyIntolerance" else "bi-file-earmark-medical" %}
        {% set icon_color = "text-success" if item.name == "Observation" else "text-warning" if item.name == "Condition" else "text-primary" if item.name == "MedicationRequest" else "text-info" if item.name == "Procedure" else "text-danger" if item.name == "AllergyIntolerance" else "text-secondary" %}
        
        {{ data_card(title, description, item.count, "files", item.url, icon_class, icon_color) }}
    {% endfor %}
</div>
{% endif %}

{% if cda_items %}
<div class="row mt-5">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="bi bi-file-earmark-medical text-primary me-2"></i>
            CDA Health Data
            <small class="text-muted ms-2">(Clinical Document Architecture)</small>
        </h2>
    </div>
</div>

<div class="row g-4">
    {% for item in cda_items %}
        {% set description = "Heart rate, oxygen saturation, respiratory rate from Apple Watch and other devices" if "vital signs" in item.name.lower() else "Laboratory test results including glucose measurements from Dexcom G7" if "laboratory" in item.name.lower() else "Height, weight, and body measurements" if "biometric" in item.name.lower() else "Health observations and measurements" %}
        {% set icon_class = "bi-heart-pulse" if "vital signs" in item.name.lower() else "bi-flask" if "laboratory" in item.name.lower() else "bi-person-badge" if "biometric" in item.name.lower() else "bi-graph-up" %}
        {% set icon_color = "text-danger" if "vital signs" in item.name.lower() else "text-primary" if "laboratory" in item.name.lower() else "text-success" if "biometric" in item.name.lower() else "text-info" %}
        
        {{ cda_data_card(item.name, description, item.count, "observations", item.url, icon_class, icon_color) }}
    {% endfor %}
</div>
{% endif %}

{% if not menu_items and not cda_items %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>No health data found!</strong>
            <p class="mb-0 mt-2">
                Please ensure your Apple Health export data is available in the configured directory.
                Check the <code>config.py</code> file to verify the data path.
            </p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.hover-shadow');
    
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });
});
</script>
{% endblock %}